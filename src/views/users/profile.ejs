<!DOCTYPE html>
<html lang="ES">
<%- include('../partials/head',{ title : 'Perfil' }) %>

  <body>
    <main class="d-flex flex-column justify-content-between" style="height: 100vh">
      <%- include('../partials/header') %>

        <section class="row">
          <div class="col-12 col-md-10 col-lg-6 mx-auto my-5">
            <div class="card shadow">
              <div class="card-header">
                <h3 class="box__card--title">Perfil de usuario</h3>
              </div>
              <div class="card-body">

                <form action="/usuarios/actualizarPerfil/<%= user.id %>?_method=PUT" class="row" method="POST" enctype="multipart/form-data" id="form-edit-user">
                  
                  <div class="text-center mb-4">
                    <img src="<%= image %>" alt="Imagen de perfil" class="img-fluid rounded-circle" style="width: 150px; height: 150px;">
                  </div>

                  <div class="col-12 col-md-6 mb-3">
                    <label for="name" class="form__label">Nombre</label>
                    <input type="text" id="name" name="name"
                      class="form-control <%= locals.errors && errors.name ? 'is-invalid' : null %>"
                      value="<%= user.name %>" />
                    <small class="text-danger ms-2" id="error-name">
                        <%= locals.errors && errors.name ? errors.name.msg : null %>
                    </small>
                  </div>

                  <div class="col-12 col-md-6 mb-3">
                    <label for="surname" class="form__label">Apellido</label>
                    <input type="text" name="surname"
                      class="form-control <%= locals.errors && errors.surname ? 'is-invalid' : null %>" id="surname"
                      value="<%= user.surname %>" />
                      <small class="text-danger ms-2" id="error-surname">
                        <%= locals.errors && errors.surname ? errors.surname.msg : null %>
                      </small>
                  </div>

                  <div class="mb-3">
                    <label for="email" class="form__label">Correo electr√≥nico</label>
                    <input type="email" name="email"
                      class="form-control <%= locals.errors && errors.email ? 'is-invalid' : null %>" id="email"
                      placeholder="Completa tu email" value="<%= user.email %>" />
                      <small class="text-danger ms-2" id="error-email">
                        <%= locals.errors && errors.email ? errors.email.msg : null %>
                      </small>
                  </div>

                  <div class="col-12 col-md-6 mb-3" id="selectedProvince">
                    <label for="province" class="form__label">Provincia</label>
                      <select class="form-select form-control  <%= locals.errors && errors.province ? 'is-invalid' : null %>" name="province" id="province">
                        <option value="" selected hidden>Seleccione... </option>
                      </select>
                      <small class="text-danger ms-2">
                        <%= locals.errors && errors.province ? errors.province.msg : null %>
                      </small>
                  </div>

                  <div class="col-12 col-md-6 mb-3" id="selectedCity">
                    <label for="city" class="form__label">Ciudad</label>
                    <select class="form-select form-control  <%= locals.errors && errors.city ? 'is-invalid' : null %>" name="city" id="city">
                      <option value="" selected hidden>Seleccione primero la provincia... </option>
                    </select>
                    <small class="text-danger ms-2">
                      <%= locals.errors && errors.city ? errors.city.msg : null %>
                    </small>
                  </div>

                  <div class=" mb-3">
                    <label for="street" class="form__label">Calle</label>
                    <input type="text" name="street" class="form-control <%= locals.errors && errors.street ? 'is-invalid' : null %>" id="street" 
                    value="<%= user.address && user.address.street ? user.address.street : null %>" />
                    <small class="text-danger ms-2">
                      <%= locals.errors && errors.street ? errors.street.msg : null %>
                    </small>
                  </div>

                  <div class="col-12 col-md-6 mb-3">
                    <label for="postal_code" class="form__label">Codigo postal</label>
                    <input type="text" name="postal_code" class="form-control <%= locals.errors && errors.postal_code ? 'is-invalid' : null %>" id="postal_code"
                      value="<%= user.address && user.address.postal_code ? user.address.postal_code : null %>" />
                      <small class="text-danger ms-2">
                        <%= locals.errors && errors.postal_code ? errors.postal_code.msg : null %>
                      </small>
                  </div>
                  <div class="col-12 col-md-6 mb-3">
                    <label for="phone" class="form__label">Telefono</label>
                    <input type="text" name="phone" class="form-control <%= locals.errors && errors.phone ? 'is-invalid' : null %>" id="phone" 
                    value="<%= user.phone || null %>" />
                    <small class="text-danger ms-2" id="error-phone">
                      <%= locals.errors && errors.phone ? errors.phone.msg : null %>
                    </small>
                  </div>

                  <% if (user && user.image) { %>
                    <figure class="product-box_image">
                        <img src="/images/users/<%= user.image %>" alt="imagen del usuario">
                    </figure>
                <% } %>
                

                  <div class="mt-3 text-center">
                    <label class="boton-guardarCambios" for="userImage">Cambiar imagen</label>
                    <input class="form-control" name="userImage" type="file" id="userImage">
                  </div>


                  <div class="col-lg-12  mb-3 d-flex align-items-center justify-content-center">
                    <button class="button button__primary">Actualizar datos</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>



        </div>
        </div>
        </div>
        <%- include('../partials/footer') %>
    </main>
    <script src="/javascripts/profileValidator.js"></script>
  </body>

</html>